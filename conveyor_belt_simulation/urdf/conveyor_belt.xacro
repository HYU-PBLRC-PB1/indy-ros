<?xml version="1.0"?>

<robot name="conveyor_belt" xmlns:xacro="http://ros.org/wiki/xacro">

  <!-- world link -->
  <link name="world" />

  <link name = "conveyor_belt_fixed">
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <mesh filename="package://conveyor_belt_simulation/meshes/conveyor_belt.dae"/>
      </geometry>
    </visual>

    <inertial>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <inertia ixx="100" ixy="0" ixz="0"
               iyy="1781.5" iyz="0"
               izz="1784.72" />
      <mass value="100" />
    </inertial>
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <box size = "1.5 0.25 0.4" />
      </geometry>
    </collision>
  </link>

  <link name = "conveyor_belt_moving">
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <box size = "1.5 0.25 0.04" />
      </geometry>
    </visual>
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <box size = "1.5 0.25 0.04" />
      </geometry>
    </collision>
    <inertial>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <mass value="100"/>
      <inertia ixx="100" iyy="1781.5" izz="1784.72" ixy="0" iyz="0" ixz="0"/>
    </inertial>
  </link>

  <gazebo reference="conveyor_belt_moving">
    <material>Gazebo/GreenTransparent</material>
  </gazebo>

  <joint name="conveyor_belt_fixed_joint" type="fixed">
    <parent link="world" />
    <child link="conveyor_belt_fixed" />
    <origin xyz = "0 0 0.35" rpy = "0 0 0"/>
  </joint>

  <joint name = "belt_joint" type = "prismatic">
    <parent link = "conveyor_belt_fixed"/>
    <child link = "conveyor_belt_moving"/>
    <origin xyz = "0 0 -0.02" rpy = "0 0 0"/>
    <limit effort = "30" velocity = "100" lower = "0" upper = "1.0" />
    <axis xyz = "1 0 0"/>
  </joint>

  <!-- ros_control plugin -->
  <gazebo>
    <plugin name="gazebo_ros_control" filename="libgazebo_ros_control.so"/>
  </gazebo>

  <gazebo>
    <plugin name="conveyor_belt_plugin" filename="libROSConveyorBeltPlugin.so">
      <enable_topic>conveyor_enable</enable_topic>
      <population_rate_modifier_topic>population/rate_modifier</population_rate_modifier_topic>
      <link>conveyor_belt_moving</link>
      <power>0</power>
      <update_rate>20</update_rate>
    </plugin>
  </gazebo>

</robot>
