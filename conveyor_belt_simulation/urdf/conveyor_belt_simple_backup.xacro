<?xml version="1.0"?>
<robot xmlns:xacro="http://www.ros.org/wiki/xacro"
       name="conveyor_belt" >

	<material name="metal_grey">
		<color rgba="0.768627450980392 0.749019607843137 0.729411764705882 1" />
	</material>
	<xacro:property name="metal" value="metal_grey"/>
	<xacro:property name="PI" value="3.1415926535897931"/>

  <!-- world link -->
  <link name="world" />

  <link name = "conveyor_belt_base">
    <visual>
      <origin xyz="0 0 0.3" rpy="0 0 0"/>
      <geometry>
        <box size = "4.5 1.5 0.6" />
      </geometry>
      <material name="${metal}"/>
    </visual>
    <collision>
      <origin xyz="0 0 0.3" rpy="0 0 0"/>
      <geometry>
        <box size = "4.5 1.5 0.6" />
      </geometry>
    </collision>
    <inertial>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <mass value="100"/>
      <inertia ixx="100" iyy="1781.5" izz="1784.72" ixy="0" iyz="0" ixz="0"/>
    </inertial>
  </link>
  <gazebo reference="conveyor_belt_base">
    <mu>1.0</mu>
    <mu2>1.0</mu2>
    <material>Gazebo/White</material>
  </gazebo>

  <link name = "conveyor_belt_fixed">
    <visual>
      <origin xyz="0 0 0.1" rpy="0 0 0"/>
      <geometry>
        <box size = "2.5 0.5 0.2" />
      </geometry>
      <material name="${metal}"/>
    </visual>
    <collision>
      <origin xyz="0 0 0.1" rpy="0 0 0"/>
      <geometry>
        <box size = "2.5 0.5 0.2" />
      </geometry>
    </collision>
    <inertial>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <mass value="100"/>
      <inertia ixx="100" iyy="1781.5" izz="1784.72" ixy="0" iyz="0" ixz="0"/>
    </inertial>
  </link>
  <gazebo reference="conveyor_belt_fixed">
    <mu>1.0</mu>
    <mu2>1.0</mu2>
    <material>Gazebo/White</material>
  </gazebo>


  <link name = "conveyor_belt_moving">
    <visual>
      <origin xyz="0 0 0.1" rpy="0 0 0"/>
      <geometry>
        <box size = "2.5 0.5 0.2" />
      </geometry>
      <material name="${metal}"/>
    </visual>
    <collision>
      <origin xyz="0 0 0.1" rpy="0 0 0"/>
      <geometry>
        <box size = "2.5 0.5 0.2" />
      </geometry>
    </collision>
    <inertial>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <mass value="100"/>
      <inertia ixx="100" iyy="1781.5" izz="1784.72" ixy="0" iyz="0" ixz="0"/>
    </inertial>
  </link>
  <gazebo reference="conveyor_belt_moving">
    <mu>1.0</mu>
    <mu2>1.0</mu2>
    <material>Gazebo/GreenTransparent</material>
<!--    <surface>-->
<!--      <friction>-->
<!--        <ode>-->
<!--          <mu>1.0</mu>-->
<!--          <mu2>1.0</mu2>-->
<!--        </ode>-->
<!--        <torsional>-->
<!--          <coefficient>1000.0</coefficient>-->
<!--          <patch_radius>0.1</patch_radius>-->
<!--        </torsional>-->
<!--      </friction>-->
<!--    </surface>-->
  </gazebo>

  <joint name="conveyor_belt_fixed_base" type="fixed">
    <parent link="world" />
    <child link="conveyor_belt_base" />
    <origin xyz="0 0 0" rpy="0 0 0" />
  </joint>

  <joint name="conveyor_belt_fixed_joint" type="fixed">
    <parent link="conveyor_belt_base" />
    <child link="conveyor_belt_fixed" />
    <origin xyz="0 0 0.6" rpy="0 0 0" />
  </joint>

  <joint name = "belt_joint" type = "prismatic">
    <parent link = "conveyor_belt_fixed"/>
    <child link = "conveyor_belt_moving"/>
    <origin xyz = "0 0 0.5" rpy = "0 0 0"/>
    <limit effort = "30" velocity = "100" lower = "0" upper = "1.0" />
    <axis xyz = "1 0 0"/>
  </joint>

  <gazebo>
    <plugin name="conveyor_belt_plugin" filename="libROSConveyorBeltPlugin.so">
      <enable_topic>conveyor_enable</enable_topic>
      <population_rate_modifier_topic>population/rate_modifier</population_rate_modifier_topic>
      <link>conveyor_belt_moving</link>
      <power>0</power>
      <update_rate>20</update_rate>
    </plugin>
  </gazebo>

</robot>
